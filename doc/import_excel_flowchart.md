```text
+-----------------------------+
| importUsers(input, flags)   |
+-----------------------------+
              |
              v
+-----------------------------+
| inputStream null?           |
+-----------------------------+
     | yes                     | no
     v                         v
+----------------------+  +---------------------------+
| throw ServiceException|  | read Excel via readSpec  |
+----------------------+  +---------------------------+
                                  |
                                  v
                   +------------------------------+
                   | ExcelHeaderMismatchException?|
                   +------------------------------+
                      | yes               | no
                      v                   v
         +----------------------------+  +---------------------------+
         | throw ServiceException      |  | other Exception?          |
         | (expected vs actual headers)|  +---------------------------+
         +----------------------------+      | yes           | no
                                              v              v
                                  +----------------------+  +----------------------+
                                  | throw ServiceException|  | init operator/context|
                                  +----------------------+  | errors, counts, batch|
                                                             +----------------------+
                                                                        |
                                                                        v
                                                         +----------------------+
                                                         | for each ExcelRow    |
                                                         +----------------------+
                                                                        |
                                                                        v
                                                    +---------------------------+
                                                    | map -> validate           |
                                                    +---------------------------+
                                                         | invalid        | valid
                                                         v                v
                                          +-------------------------+  +----------------------+
                                          | add UserImportRowError  |  | context + isUpdate   |
                                          | continue                |  | generate entity      |
                                          +-------------------------+  +----------------------+
                                                                              |
                                                                              v
                                                                 +--------------------------+
                                                                 | dryRun?                  |
                                                                 +--------------------------+
                                                                   | yes           | no
                                                                   v               v
                                                         +----------------+  +--------------------------+
                                                         | skip save      |  | add to batch;            |
                                                         +----------------+  | if batch full -> saveAll |
                                                                               +--------------------------+
                                                                              |
                                                                              v
                                                                  +----------------------+
                                                                  | update counts        |
                                                                  +----------------------+
                                                                        |
                                                                        v
                                                         +--------------------------------+
                                                         | end loop -> flush pending batch|
                                                         +--------------------------------+
                                                                        |
                                                                        v
                                                         +----------------------------------+
                                                         | totals + return UserImportResult |
                                                         +----------------------------------+
```
